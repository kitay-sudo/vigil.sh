# Security Monitor - –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## v2.2 - HTTP API —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (SECURE)

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π HTTP API

–î–æ–±–∞–≤–ª–µ–Ω –∑–∞—â–∏—â—ë–Ω–Ω—ã–π HTTP API —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

**üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- **API –∫–ª—é—á –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π header `X-API-Key`
- **32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–ª—é—á** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ (openssl rand -hex 16)
- **401 Unauthorized** - –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫** - –≤—Å–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥
- **Read-only API** - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏** - `/watchdog/*` –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö `/api/*`

**Endpoints:**
- `GET /watchdog/health` - healthcheck (uptime, —Å—Ç–∞—Ç—É—Å)
- `GET /watchdog/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —É–≥—Ä–æ–∑—ã, —Ç–æ–ø —Å—Ç—Ä–∞–Ω)
- `GET /watchdog/status` - –ø–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å (–∫–æ–Ω—Ñ–∏–≥, –∑–∞—â–∏—Ç–∞, whitelist)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```json
{
  "api": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 8765,
    "api_key": "a8f5d9c2b1e4f7a3d6c9e2b5f8a1d4c7"
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
export API_KEY="a8f5d9c2b1e4f7a3d6c9e2b5f8a1d4c7"

# Healthcheck
curl -H "X-API-Key: $API_KEY" http://localhost:8765/watchdog/health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl -H "X-API-Key: $API_KEY" http://localhost:8765/watchdog/stats | jq

# –ü–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å
curl -H "X-API-Key: $API_KEY" http://localhost:8765/watchdog/status | jq

# –ë–µ–∑ –∫–ª—é—á–∞ - 401 Unauthorized
curl http://localhost:8765/watchdog/stats
# {"error": "Unauthorized", "message": "Valid X-API-Key header required"}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å nginx:**
–ú–æ–∂–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ nginx –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ –¥–æ–º–µ–Ω—É:
```nginx
location /watchdog/ {
    proxy_pass http://localhost:8765/watchdog/;
    proxy_set_header X-API-Key $http_x_api_key;  # –ü—Ä–æ–±—Ä–æ—Å API –∫–ª—é—á–∞
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –î–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (read-only API)
- –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ iptables –∏–ª–∏ host –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `"host": "127.0.0.1"` –¥–ª—è localhost-only

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ uptime (healthchecks)
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ —Å–∫—Ä–∏–ø—Ç—ã

---

## v2.1 - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSH

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSH –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```json
{
  "enable_ssh_monitoring": true,  // –∏–ª–∏ false –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
  "ssh_port": 22                   // –≤–∞—à –ø–æ—Ä—Ç SSH
}
```

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**
- –ï—Å–ª–∏ –≤—ã –æ—Ç–∫–ª—é—á–∏–ª–∏ –ø–∞—Ä–æ–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é SSH –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
- SSH –±—Ä—É—Ç—Ñ–æ—Ä—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSH –∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞—â–∏—Ç—É –æ—Ç DDoS/—Ñ–ª—É–¥–∞

### 2. –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ SSH

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞—à SSH –ø–æ—Ä—Ç:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ SSH —Å–µ—Ä–≤–∏—Å—ã
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç
- –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç –≤—Ä—É—á–Ω—É—é

### 3. –°–∏—Å—Ç–µ–º–∞ –±–µ–ª—ã—Ö —Å–ø–∏—Å–∫–æ–≤

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!** –î–≤–∞ —Ç–∏–ø–∞ –±–µ–ª—ã—Ö —Å–ø–∏—Å–∫–æ–≤:

#### SSH Whitelist (–ê–¥–º–∏–Ω—Å–∫–∏–µ IP)
```json
{
  "ssh_whitelist": [
    "94.241.174.106",
    "YOUR_HOME_IP"
  ]
}
```
- IP –∏–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã** –∑–∞ SSH –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∞—à–∏—Ö –ª–∏—á–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä

#### Service Whitelist (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã)
```json
{
  "service_whitelist": [
    "127.0.0.1",
    "89.223.64.38",    // MongoDB —Å–µ—Ä–≤–µ—Ä
    "10.0.0.5"         // Redis —Å–µ—Ä–≤–µ—Ä
  ]
}
```
- IP –∏–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (MongoDB, Redis, API —Å–µ—Ä–≤–µ—Ä—ã)
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤–∞—à–∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 4. –ì–∏–±–∫–∞—è –∑–∞—â–∏—Ç–∞

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –∞ —á—Ç–æ —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:

```json
{
  "protection": {
    "block_ssh_bruteforce": false,     // –≤—ã–∫–ª –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
    "block_unknown_ssh": false,        // –≤—ã–∫–ª –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
    "block_syn_flood": true,           // –≤—Å–µ–≥–¥–∞ –≤–∫–ª - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS
    "block_excessive_http": false,     // –æ–±—ã—á–Ω–æ –≤—ã–∫–ª - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    "notify_excessive_http": true      // –Ω–æ —É–≤–µ–¥–æ–º–ª—è–µ–º –æ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
  }
}
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `./install.sh` –∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
- –•–æ—Ç–∏—Ç–µ –ª–∏ –≤–∫–ª—é—á–∏—Ç—å SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥?
- –ö–∞–∫–æ–π –ø–æ—Ä—Ç SSH –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- –ö–∞–∫–∏–µ IP –¥–æ–±–∞–≤–∏—Ç—å –≤ SSH whitelist?
- –ö–∞–∫–∏–µ IP –¥–æ–±–∞–≤–∏—Ç—å –≤ Service whitelist?

### –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### –î–æ–±–∞–≤–∏—Ç—å IP –≤ SSH whitelist:
```bash
security-monitor --add-ssh-whitelist 94.241.174.106
```

#### –î–æ–±–∞–≤–∏—Ç—å IP –≤ Service whitelist:
```bash
security-monitor --add-service-whitelist 89.223.64.38
```

#### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
security-monitor --show-status
```

#### –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥:
```bash
nano /opt/security-monitor/config.json
systemctl restart security-monitor
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å SSH –ø–æ –∫–ª—é—á–∞–º (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π):
```json
{
  "enable_ssh_monitoring": false,
  "ssh_whitelist": ["YOUR_IP"],
  "service_whitelist": ["127.0.0.1", "YOUR_INTERNAL_IPS"],
  "protection": {
    "block_ssh_bruteforce": false,
    "block_unknown_ssh": false,
    "block_syn_flood": true,
    "block_excessive_http": false,
    "notify_excessive_http": true
  }
}
```

### –î–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –ø–∞—Ä–æ–ª—å–Ω—ã–º SSH:
```json
{
  "enable_ssh_monitoring": true,
  "ssh_port": 22,
  "ssh_whitelist": ["YOUR_IP"],
  "service_whitelist": ["127.0.0.1", "YOUR_INTERNAL_IPS"],
  "protection": {
    "block_ssh_bruteforce": true,
    "block_unknown_ssh": true,
    "block_syn_flood": true,
    "block_excessive_http": false,
    "notify_excessive_http": true
  }
}
```

## –í–∞–∂–Ω–æ!

- **SSH Whitelist** - –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤–∞—à–∏—Ö IP
- **Service Whitelist** - –∑–∞—â–∏—â–∞–µ—Ç –≤–∞—à–∏ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- IP –∏–∑ –ª—é–±–æ–≥–æ whitelist **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è**
- Localhost (127.0.0.1) **–≤—Å–µ–≥–¥–∞** –≤ whitelist –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
- SYN flood –∑–∞—â–∏—Ç–∞ **–≤—Å–µ–≥–¥–∞** –∞–∫—Ç–∏–≤–Ω–∞ (—ç—Ç–æ DDoS –∞—Ç–∞–∫–∞, –Ω–µ –æ–±—ã—á–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫)
